<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>活動報名</title>
    <!-- LIFF SDK -->
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <!-- 載入中畫面 -->
    <div id="loading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
        <div class="bg-white p-4 rounded-lg">載入中...</div>
    </div>

    <!-- 主要內容 -->
    <div id="content" class="container mx-auto px-4 py-8 max-w-md hidden">
        <!-- 登入狀態 -->
        <div id="loginStatus" class="bg-white rounded-lg shadow-md p-4 mb-4">
            <p id="userProfile" class="text-gray-700">尚未登入</p>
        </div>

        <!-- 測試按鈕 -->
        <div class="space-y-4">
            <button onclick="getUserProfile()" class="w-full bg-blue-500 text-white py-2 rounded-lg">
                取得用戶資料
            </button>
            <button onclick="shareMessage()" class="w-full bg-green-500 text-white py-2 rounded-lg">
                分享訊息
            </button>
            <button onclick="closeLIFF()" class="w-full bg-gray-500 text-white py-2 rounded-lg">
                關閉 LIFF
            </button>
        </div>
    </div>

    <script>
        // LIFF ID
        const LIFF_ID = '1656516134-VaGgmaPm'; // 替換成你的 LIFF ID

        // 顯示/隱藏載入中
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'flex' : 'none';
        }

        // 顯示內容
        function showContent() {
            document.getElementById('content').classList.remove('hidden');
        }

        // 初始化 LIFF
        async function initializeLiff() {
            try {
                await liff.init({ liffId: LIFF_ID });
                // 檢查是否登入
                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    const profile = await liff.getProfile();
                    document.getElementById('userProfile').textContent = 
                        `已登入：${profile.displayName}`;
                    showContent();
                }
            } catch (err) {
                console.error('LIFF 初始化失敗', err);
                alert('初始化失敗，請重新整理頁面');
            } finally {
                showLoading(false);
            }
        }

        // 取得用戶資料
        async function getUserProfile() {
            try {
                const profile = await liff.getProfile();
                alert(`名稱：${profile.displayName}\nID：${profile.userId}`);
            } catch (err) {
                console.error('取得用戶資料失敗', err);
                alert('取得用戶資料失敗');
            }
        }

        // 分享訊息
        async function shareMessage() {
            if (liff.isApiAvailable('shareTargetPicker')) {
                try {
                    await liff.shareTargetPicker([
                        {
                            type: "text",
                            text: "這是一個測試訊息！"
                        }
                    ]);
                } catch (err) {
                    console.error('分享失敗', err);
                    alert('分享失敗');
                }
            }
        }

        // 關閉 LIFF
        function closeLIFF() {
            if (liff.isInClient()) {
                liff.closeWindow();
            } else {
                alert('這個功能只能在 LINE APP 內使用');
            }
        }

        // 頁面載入時初始化
        window.onload = initializeLiff;
    </script>
</body>
</html>
